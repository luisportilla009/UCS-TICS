<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Formulario</title>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <style>
      .section { display: none; }
      .active { display: block; }
      .asterisk { color: rgb(217, 48, 37); padding-left: .25em; }

      :root {
        --bs-btn-bg: #5e35b1;
        --bs-btn-border-color: #5e35b1;
        --bs-btn-hover-bg: #4527a0; /* Darker purple */
        --bs-btn-hover-border-color: #4527a0;

        --bs-primary: #5e35b1;
        --bs-primary-rgb: 94, 53, 177;
        --bs-primary-hover: #4a2f91;

        --bs-secondary: #9575cd;
        --bs-secondary-rgb: 149, 117, 205;
        --bs-secondary-hover: #7e57c2;

        --bs-success: #43a047;
        --bs-success-rgb: 67, 160, 71;
        --bs-success-hover: #388e3c;

        --bs-danger: #d32f2f;
        --bs-danger-rgb: 211, 47, 47;
        --bs-danger-hover: #b71c1c;

        --bs-warning: #fbc02d;
        --bs-warning-rgb: 251, 192, 45;
        --bs-warning-hover: #f9a825;

        --bs-info: #7986cb;
        --bs-info-rgb: 121, 134, 203;
        --bs-info-hover: #5c6bc0;

        --bs-light: #ede7f6;
        --bs-light-rgb: 237, 231, 246;

        --bs-dark: #311b92;
        --bs-dark-rgb: 49, 27, 146;
      }

      /* Background */
      body {
        background-color: #f7f3fc; /* Light purple-white */
      }

      /* Card styling */
      .card {
        border-radius: 1rem;
        box-shadow: 0 0.5rem 1.2rem rgba(0, 0, 0, 0.07);
      }

      /* Label text */
      label.form-label {
        color: var(--bs-primary);
        font-weight: 600;
      }

      /* Spacing for radio buttons */
      .btn-check + .btn {
        margin-bottom: 0.5rem;
      }

      /* Radio button styling */
      .btn-outline-primary {
        color: var(--bs-primary);
        border-color: var(--bs-primary);
        background-color: transparent;
        transition: all 0.2s ease-in-out;
        font-weight: 600;
      }

      .btn-outline-primary:hover {
        color: #fff;
        background-color: var(--bs-primary-hoover);
        border-color: var(--bs-primary-hover);
      }

      .btn-check + .btn-outline-primary:hover {
        color: #fff;
        background-color: var(--bs-primary-hover, #845fc6);
        border-color: var(--bs-primary-hover, #845fc6);
      }

      .btn-check:checked + .btn-outline-primary {
        color: #fff;
        background-color: var(--bs-primary);
        border-color: var(--bs-primary);
      }

      .btn-check:focus + .btn-outline-primary {
        box-shadow: 0 0 0 0.3rem rgba(94, 53, 177, 0.7);
        outline-offset: 2px;
      }

      .btn-primary {
        background-color: var(--bs-primary);
        border-color: var(--bs-primary);
        color: #fff;
      }

      .btn-primary:hover,
      .btn-primary:focus {
        background-color: var(--bs-primary-hover);
        border-color: var(--bs-primary-hover);
        color: #fff;
      }

      /* Secondary button */
      .btn-secondary {
        background-color: var(--bs-secondary);
        border-color: var(--bs-secondary);
        color: #fff;
      }

      .btn-secondary:hover,
      .btn-secondary:focus {
        background-color: var(--bs-secondary-hover);
        border-color: var(--bs-secondary-hover);
        color: #fff;
      }

      /* Success button */
      .btn-success {
        background-color: var(--bs-success);
        border-color: var(--bs-success);
        color: #fff;
      }

      .btn-success:hover,
      .btn-success:focus {
        background-color: var(--bs-success-hover);
        border-color: var(--bs-success-hover);
        color: #fff;
      }

      /* Danger button */
      .btn-danger {
        background-color: var(--bs-danger);
        border-color: var(--bs-danger);
        color: #fff;
      }

      .btn-danger:hover,
      .btn-danger:focus {
        background-color: var(--bs-danger-hover);
        border-color: var(--bs-danger-hover);
        color: #fff;
      }

      /* Warning button */
      .btn-warning {
        background-color: var(--bs-warning);
        border-color: var(--bs-warning);
        color: #212529;
      }

      .btn-warning:hover,
      .btn-warning:focus {
        background-color: var(--bs-warning-hover);
        border-color: var(--bs-warning-hover);
        color: #212529;
      }

      /* Info button */
      .btn-info {
        background-color: var(--bs-info);
        border-color: var(--bs-info);
        color: #fff;
      }

      .btn-info:hover,
      .btn-info:focus {
        background-color: var(--bs-info-hover);
        border-color: var(--bs-info-hover);
        color: #fff;
      }

      /* Light button */
      .btn-light {
        background-color: var(--bs-light);
        border-color: var(--bs-light);
        color: #212529;
      }

      .btn-light:hover,
      .btn-light:focus {
        background-color: #dcd6f0;
        border-color: #dcd6f0;
        color: #212529;
      }

      /* Dark button */
      .btn-dark {
        background-color: var(--bs-dark);
        border-color: var(--bs-dark);
        color: #fff;
      }

      .btn-dark:hover,
      .btn-dark:focus {
        background-color: #2a1475;
        border-color: #2a1475;
        color: #fff;
      }

      .btn-text {
        background: none;
        border: none;
        color: #6f42c1;
        text-decoration: underline;
        padding: 0.5rem 1rem;
        font-weight: 500;
      }

      .btn-text:hover {
        background-color: #f4ebfa;
      }

      .form-select:focus {
        border-color: var(--bs-primary);
        box-shadow: 0 0 0 0.25rem rgba(111, 66, 193, 0.25);
      }

      .spinner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(255, 255, 255, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      /* .form-select {
        background-color: #faf4ff;
      } */

    </style>
  </head>

  <body style="background-color: #f5f0fa;">
    <div class="container position-relative">

      <!-- MENUSECTION -->
      <div class="section active container" id="MenuSection">
        <div class="d-grid gap-3">
          <button type="button" class="btn btn-primary" onclick="goToSection('InventarioSection')">Inventario</button>
          <button type="button" class="btn btn-primary" onclick="goToSection('PréstamoSection')">Préstamo</button>
          <button type="button" class="btn btn-primary" onclick="goToSection('DevoluciónSection')">Devolución</button>
          <button type="button" class="btn btn-primary" onclick="goToSection('SoporteSection')">Soporte</button>
          <!-- <button type="button" class="btn btn-primary" onclick="goToSection('BajaDeActivosSection')">Baja de activos</button> -->
          <button type="button" class="btn btn-primary" onclick="goToSection('InformaciónSection')">Información</button>
        </div>
      </div>
    </div>

    <!-- INVENTARIOSECTION -->
    <div class="section container" id="InventarioSection">
      <h2 class="text-center text-primary">Inventario</h2>
      <form id="Inventario" onsubmit="handleSubmit(event)">

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Placa inventario<span class="text-danger">*</span>
          </label>
          <div class="row g-3">
            <div class="col-12 col-sm-4">
              <select
                id="i_tdp"
                name="Tipo de Placa (I)"
                class="form-select shadow-sm border rounded-3"
                required
              >
                <option value="" disabled selected>Tipo</option>
                <option value="FUCS">FUCS</option>
                <option value="TMS">TMS</option>
              </select>
            </div>
            <div class="col-12 col-sm-8">
              <input
                type="text"
                id="i_pi"
                name="Placa Inventario (I)"
                class="form-control shadow-sm border rounded-3"
                placeholder="Número de placa"
                required
              >
            </div>
          </div>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Sede<span class="text-danger">*</span>
          </label>

          <div class="d-grid gap-3">

            <input
              type="radio"
              class="btn-check"
              name="Sede (I)"
              id="i_s_Torobajo"
              value="Torobajo"
              data-toggle-target="#i_u_Torobajo_card"
              data-toggle-value="Torobajo"
              required
              >
            <label class="btn btn-outline-primary text-start w-100" for="i_s_Torobajo">
              Torobajo
            </label>

            <input
              type="radio"
              class="btn-check"
              name="Sede (I)"
              id="i_s_Centro"
              value="Centro"
              data-toggle-target="#i_u_Centro_card"
              data-toggle-value="Centro"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="i_s_Centro">
              Centro
            </label>
          
          </div>
        </div>

        <div id="i_u_Torobajo_card" data-controlled-by="Sede (I)" class="card shadow-sm p-4 mb-4">
          <label for="i_u_Torobajo" class="form-label fw-semibold text-primary">
            Ubicación ( Oficina - Aula)<span class="text-danger">*</span>
          </label>
          <select id="i_u_Torobajo" name="Ubicación ( Oficina - Aula) (I)" class="form-select shadow-sm border rounded-3" required>
            <option value="" selected>Selecciona una opción</option>
          </select>
        </div>

        <div id="i_u_Centro_card" data-controlled-by="Sede (I)" class="card shadow-sm p-4 mb-4">
          <label for="i_u_Centro" class="form-label fw-semibold text-primary">
            Ubicación ( Oficina - Aula)<span class="text-danger">*</span>
          </label>
          <select id="i_u_Centro" name="Ubicación ( Oficina - Aula) (I)" class="form-select shadow-sm border rounded-3" required>
            <option value="" selected>Selecciona una opción</option>
          </select>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label for="i_tdr" class="form-label fw-semibold text-primary">
            Tipo de recurso<span class="text-danger">*</span>
          </label>
          <select id="i_tdr" name="Tipo de Recurso (I)" class="form-select shadow-sm border rounded-3" required>
            <option value="" disabled selected>Selecciona una opción</option>
            <option value="Control HDMI">Control HDMI</option>
            <option value="Computador Escritorio">Computador Escritorio</option>
            <option value="Todo en Uno">Todo en Uno</option>
            <option value="Portátil">Portátil</option>
            <option value="Parlante">Parlante</option>
            <option value="Micrófono">Micrófono</option>
            <option value="Celular">Celular</option>
            <option value="Cámara">Cámara</option>
            <option value="Impresora">Impresora</option>
            <option value="Scanner">Scanner</option>
            <option value="Televisor">Televisor</option>
            <option value="Otro">Otro</option>
          </select>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label for="i_mym" class="form-label fw-semibold">
            Marca y Modelo<span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="i_mym"
            name="Marca y Modelo (I)"
            class="form-control shadow-sm border rounded-3"
            placeholder="Ej: HP Pavilion 15"
            required
          >
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Estado<span class="text-danger">*</span>
          </label>

          <div class="d-grid gap-3">

            <input
              type="radio"
              class="btn-check"
              name="Estado (I)"
              id="i_e_Asignado"
              value="Asignado"
              data-toggle-target="#i_r_card"
              data-toggle-value="Asignado"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="i_e_Asignado">
              Asignado
            </label>

            <input type="radio" class="btn-check" name="Estado (I)" id="i_e_Prestamo" value="Para préstamo" required>
            <label class="btn btn-outline-primary text-start w-100" for="i_e_Prestamo">
              Para préstamo
            </label>
          
            <input type="radio" class="btn-check" name="Estado (I)" id="i_e_Pendiente" value="Pendiente Asignación" required>
            <label class="btn btn-outline-primary text-start w-100" for="i_e_Pendiente">
              Pendiente Asignación
            </label>
          
            <input type="radio" class="btn-check" name="Estado (I)" id="i_e_Baja" value="Dado de baja" required>
            <label class="btn btn-outline-primary text-start w-100" for="i_e_Baja">
              Dado de baja
            </label>
          
          </div>
        </div>

        <div
          id="i_r_card"
          class="card shadow-sm p-4 mb-4 d-none"
          data-controlled-by="Estado (I)"
        >
          <label for="i_r" class="form-label fw-semibold">
            Responsable<span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="i_r"
            name="Responsable (I)"
            class="form-control shadow-sm border rounded-3"
            required
          >
        </div>

        <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
          <button class="btn btn-text" type="button" onclick="returnToMenu()">Regresar</button>
          <button id="submit-button" class="btn btn-primary" type="submit">Enviar</button>
        </div>

      </form>
    </div>

    <!-- PRÉSTAMOSECTION -->
    <div class="section container" id="PréstamoSection">
      <h2 class="text-center text-primary">Préstamo</h2>
      <form id="Préstamo" onsubmit="handleSubmit(event)">

        <div class="card shadow-sm p-4 mb-4">
          <label for="p_nds" class="form-label fw-semibold">
            Nombre del solicitante<span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="p_nds"
            name="Nombre del solicitante (P)"
            class="form-control shadow-sm border rounded-3"
            required
          >
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Tipo de solicitante<span class="text-danger">*</span>
          </label>
          <div class="d-grid gap-3">

            <input type="radio" class="btn-check" name="Tipo de solicitante (P)" id="p_vds_Administrativo" value="Administrativo" required>
            <label class="btn btn-outline-primary text-start w-100" for="p_vds_Administrativo">
              Administrativo
            </label>

            <input type="radio" class="btn-check" name="Tipo de solicitante (P)" id="p_vds_Profesor" value="Profesor" required>
            <label class="btn btn-outline-primary text-start w-100" for="p_vds_Profesor">
              Profesor
            </label>

            <input type="radio" class="btn-check" name="Tipo de solicitante (P)" id="p_vds_Estudiante" value="Estudiante" required>
            <label class="btn btn-outline-primary text-start w-100" for="p_vds_Estudiante">
              Estudiante
            </label>

            <input type="radio" class="btn-check" name="Tipo de solicitante (P)" id="p_vds_Otro" value="Otro" required>
            <label class="btn btn-outline-primary text-start w-100" for="p_vds_Otro">
              Otro
            </label>
          
          </div>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Sede<span class="text-danger">*</span>
          </label>
          <div class="d-grid gap-3">

            <input
              type="radio"
              class="btn-check"
              name="Sede (P)"
              id="p_s_Torobajo"
              value="Torobajo"
              data-toggle-target="#p_chdmi_Torobajo_card, #p_cportatil_Torobajo_card, #p_cotro_Torobajo_card"
              data-toggle-value="Torobajo"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="p_s_Torobajo">
              Torobajo
            </label>

            <input
              type="radio"
              class="btn-check"
              name="Sede (P)"
              id="p_s_Centro"
              value="Centro"
              data-toggle-target="#p_chdmi_Centro_card, #p_cportatil_Centro_card, #p_cotro_Centro_card"
              data-toggle-value="Centro"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="p_s_Centro">
              Centro
            </label>
          
          </div>
        </div>

        <div id="p_chdmi_Torobajo_card" data-controlled-by="Sede (P)" class="card shadow-sm p-4 mb-4">
          <label for="p_chdmi_Torobajo" class="form-label fw-semibold text-primary">
            Cuál control HDMI?
          </label>
          <select id="p_chdmi_Torobajo" name="Cuál control HDMI? (P)" class="form-select shadow-sm border rounded-3" multiple  required="false">
          </select>
        </div>

        <div id="p_cportatil_Torobajo_card" data-controlled-by="Sede (P)" class="card shadow-sm p-4 mb-4">
          <label for="p_cportatil_Torobajo" class="form-label fw-semibold text-primary">
            Cuál portátil?
          </label>
          <select id="p_cportatil_Torobajo" name="Cuál portátil? (P)" class="form-select shadow-sm border rounded-3" multiple required="false">
          </select>
        </div>

        <div id="p_cotro_Torobajo_card" data-controlled-by="Sede (P)" class="card shadow-sm p-4 mb-4">
          <label for="p_cotro_Torobajo" class="form-label fw-semibold text-primary">
            Cuál otro?
          </label>
          <select id="p_cotro_Torobajo" name="Cuál otro? (P)" class="form-select shadow-sm border rounded-3" multiple required="false">
          </select>
        </div>

        <div id="p_chdmi_Centro_card" data-controlled-by="Sede (P)" class="card shadow-sm p-4 mb-4">
          <label for="p_chdmi_Centro" class="form-label fw-semibold text-primary">
            Cuál control HDMI?
          </label>
          <select id="p_chdmi_Centro" name="Cuál control HDMI? (P)" class="form-select shadow-sm border rounded-3" multiple required="false">
          </select>
        </div>

        <div id="p_cportatil_Centro_card" data-controlled-by="Sede (P)" class="card shadow-sm p-4 mb-4">
          <label for="p_cportatil_Centro" class="form-label fw-semibold text-primary">
            Cuál portátil?
          </label>
          <select id="p_cportatil_Centro" name="Cuál portátil? (P)" class="form-select shadow-sm border rounded-3" multiple required="false">
          </select>
        </div>

        <div id="p_cotro_Centro_card" data-controlled-by="Sede (P)" class="card shadow-sm p-4 mb-4">
          <label for="p_cotro_Centro" class="form-label fw-semibold text-primary">
            Cuál otro?
          </label>
          <select id="p_cotro_Centro" name="Cuál otro? (P)" class="form-select shadow-sm border rounded-3" multiple required="false">
          </select>
        </div>

        <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
          <button class="btn btn-text" type="button" onclick="returnToMenu()">Regresar</button>
          <button id="submit-button" class="btn btn-primary" type="submit">Enviar</button>
        </div>
      </form>
    </div>

    <!-- DEVOLUCIÓNSECTION -->
    <div class="section container" id="DevoluciónSection">
      <h2 class="text-center text-primary">Devolución</h2>
      <form id="Devolución" onsubmit="handleSubmit(event)">

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Sede<span class="text-danger">*</span>
          </label>
          
          <div class="d-grid gap-3">

            <input
              type="radio"
              class="btn-check"
              name="Sede (D)"
              id="d_s_Torobajo"
              value="Torobajo"
              data-toggle-target="#d_sol_Torobajo_card"
              data-toggle-value="Torobajo"
              required
              >
            <label class="btn btn-outline-primary text-start w-100" for="d_s_Torobajo">
              Torobajo
            </label>

            <input
              type="radio"
              class="btn-check"
              name="Sede (D)"
              id="d_s_Centro"
              value="Centro"
              data-toggle-target="#d_sol_Centro_card"
              data-toggle-value="Centro"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="d_s_Centro">
              Centro
            </label>
          
          </div>

        </div>

        <div id="d_sol_Torobajo_card" data-controlled-by="Sede (D)" class="card shadow-sm p-4 mb-4">
          <label for="d_sol_Torobajo_select" class="form-label fw-semibold text-primary">
            Nombre del solicitante<span class="text-danger">*</span>
          </label>
          <select id="d_sol_Torobajo_select" name="Nombre del solicitante (D)" class="form-select shadow-sm border rounded-3" required>
            <option value="" selected>Selecciona una opción</option>
          </select>
          <div id="d_devices_Torobajo" class="mt-3"></div>
        </div>

        <div id="d_sol_Centro_card" data-controlled-by="Sede (D)" class="card shadow-sm p-4 mb-4">
          <label for="d_sol_Centro_select" class="form-label fw-semibold text-primary">
            Nombre del solicitante<span class="text-danger">*</span>
          </label>
          <select id="d_sol_Centro_select" name="Nombre del solicitante (D)" class="form-select shadow-sm border rounded-3" required>
            <option value="" selected>Selecciona una opción</option>
          </select>
          <div id="d_devices_Centro" class="mt-3"></div>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Estado de la devolución<span class="text-danger">*</span>
          </label>
          <div class="d-grid gap-3">

            <input type="radio" class="btn-check" name="Estado del equipo al momento de la devolución (D)" id="d_edld_OK" value="OK" required>
            <label class="btn btn-outline-primary text-start w-100" for="d_edld_OK">
              OK
            </label>
          
            <input
              type="radio"
              class="btn-check"
              name="Estado del equipo al momento de la devolución (D)"
              id="d_edld_Problemas"
              value="Con problemas"
              data-toggle-target="#d_causa_problemas_card"
              data-toggle-value="Con problemas"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="d_edld_Problemas">
              Con problemas
            </label>

            <input
              type="radio"
              class="btn-check"
              name="Estado del equipo al momento de la devolución (D)"
              id="d_edld_Nofunciona"
              value="No funciona"
              data-toggle-target="#d_causa_no_funciona_card"
              data-toggle-value="No funciona"
              required
            >
            <label class="btn btn-outline-primary text-start w-100" for="d_edld_Nofunciona">
              No funciona
            </label>

          
          </div>
        </div>

        <div id="d_causa_problemas_card" data-controlled-by="Estado de la devolución (D)" class="card shadow-sm p-4 mb-4">
          <label for="d_causa_problemas" class="form-label fw-semibold">
            Causa del problema o no funcionamiento?<span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="d_causa_problemas"
            name="Causa del problema o no funcionamiento? (D)"
            class="form-control shadow-sm border rounded-3"
            required
          >
        </div>

        <div id="d_causa_no_funciona_card" data-controlled-by="Estado de la devolución (D)" class="card shadow-sm p-4 mb-4">
          <label for="d_causa_no_funciona" class="form-label fw-semibold">
            Causa del problema o no funcionamiento?<span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="d_causa_no_funciona"
            name="Causa del problema o no funcionamiento? (D)"
            class="form-control shadow-sm border rounded-3"
            required
          >
        </div>

        <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
          <button class="btn btn-text" type="button" onclick="returnToMenu()">Regresar</button>
          <button id="submit-button" class="btn btn-primary" type="submit">Enviar</button>
        </div>
      </form>
    </div>

    <!-- SOPORTESECTION -->
    <div class="section container" id="SoporteSection">
      <h2 class="text-center text-primary">Soporte</h2>
      <form id="Soporte" onsubmit="handleSubmit(event)">

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Placa inventario<span class="text-danger">*</span>
          </label>
          <div class="row g-3">
            <div class="col-12 col-sm-6">

              <input
                type="radio"
                class="btn-check"
                name="Tipo de Placa (S)"
                id="s_tdp_FUCS"
                value="FUCS"
                data-toggle-target="#s_pi_FUCS_card"
                data-toggle-value="FUCS"
                required
                >
              <label class="btn btn-outline-primary text-start w-100" for="s_tdp_FUCS">
                FUCS
              </label>

              <input
                type="radio"
                class="btn-check"
                name="Tipo de Placa (S)"
                id="s_tdp_TMS"
                value="TMS"
                data-toggle-target="#s_pi_TMS_card"
                data-toggle-value="TMS"
                required
              >
              <label class="btn btn-outline-primary text-start w-100" for="s_tdp_TMS">
                TMS
              </label>
            </div>
            <div class="col-12 col-sm-6">
              <div id="s_pi_FUCS_card" data-controlled-by="s_tdp_FUCS">
                <select id="s_pi_FUCS_select" name="Placa Inventario (S)" class="form-select shadow-sm border rounded-3" required>
                  <option value="" selected>Selecciona una opción</option>
                </select>
              </div>
              <div id="s_pi_TMS_card" data-controlled-by="s_tdp_TMS">
                <select id="s_pi_TMS_select" name="Placa Inventario (S)" class="form-select shadow-sm border rounded-3" required>
                  <option value="" selected>Selecciona una opción</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label for="s_hdi" class="form-label fw-semibold">Hora de inicio<span class="text-danger">*</span></label>
          <input type="time" class="form-control shadow-sm border rounded-3" id="s_hdi" name="Hora de inicio (S)" required>
        </div>
          
        <div class="card shadow-sm p-4 mb-4">
          <label for="s_hf" class="form-label fw-semibold">Hora fin<span class="text-danger">*</span></label>
          <input type="time" class="form-control shadow-sm border rounded-3" id="s_hf" name="Hora final (S)" required>
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label for="s_ds" class="form-label fw-semibold">Descripción soporte<span class="text-danger">*</span></label>
          <input type="text" class="form-control shadow-sm border rounded-3" id="s_ds" name="Descripción soporte (S)" required>
        </div>
        
        <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
          <button class="btn btn-text" type="button" onclick="returnToMenu()">Regresar</button>
          <button id="submit-button" class="btn btn-primary" type="submit">Enviar</button>
        </div>

      </form>
    </div>

    <!-- BAJADEACTIVOSSECTION -->
    <!-- <div class="section container" id="BajaDeActivosSection">
      <h2 class="text-center text-primary">Baja de activos</h2>
      <form id="Bajadeactivos" onsubmit="handleSubmit(event)">

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Sede<span class="text-danger">*</span>
          </label>

          <div class="d-grid gap-3">

            <input type="radio" class="btn-check" name="Sede (B)" id="b_s_Torobajo" value="Torobajo" required>
            <label class="btn btn-outline-primary text-start w-100" for="b_s_Torobajo">
              Torobajo
            </label>
          
            <input type="radio" class="btn-check" name="Sede (B)" id="b_s_Centro" value="Centro" required>
            <label class="btn btn-outline-primary text-start w-100" for="b_s_Centro">
              Centro
            </label>
          
          </div>
          
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label class="form-label fw-semibold">
            Dictamen técnico - Calificación del equipo<span class="text-danger">*</span>
          </label>

          <div class="d-grid gap-3">

            <input type="radio" class="btn-check" name="Dictamen técnico (B)" id="b_dtcde_Bajadefinitiva" value="Baja definitiva" required>
            <label class="btn btn-outline-primary text-start w-100" for="b_dtcde_Bajadefinitiva">
              Baja definitiva
            </label>
          
            <input type="radio" class="btn-check" name="Dictamen técnico (B)" id="b_dtcde_Bajaparabodega" value="Baja para bodega" required>
            <label class="btn btn-outline-primary text-start w-100" for="b_dtcde_Bajaparabodega">
              Baja para bodega y futuro aprovechamiento de piezas o componentes
            </label>

            <input type="radio" class="btn-check" name="Dictamen técnico (B)" id="b_dtcde_Bajaparadonación" value="Baja para donación" required>
            <label class="btn btn-outline-primary text-start w-100" for="b_dtcde_Bajaparadonación">
              Baja para donación a otras instituciones
            </label>
          
          </div>
          
        </div>

        <div class="card shadow-sm p-4 mb-4">
          <label for="b_m" class="form-label fw-semibold">
            Motivo<span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="b_m"
            name="Motivo (B)"
            class="form-control shadow-sm border rounded-3"
            required
          >
        </div>

        <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
          <button class="btn btn-text" type="button" onclick="returnToMenu()">Regresar</button>
          <button id="submit-button" class="btn btn-primary" type="submit">Enviar</button>
        </div>
      </form>
    </div> -->

    <!-- INFORMACIÓNSECTION -->
    <div class="section container" id="InformaciónSection">
      <h2 class="text-center text-primary">Información</h2>
      <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
        <button class="btn btn-text" type="button" onclick="returnToMenu()">Regresar</button>
        <button id="submit-button" class="btn btn-primary" type="submit">Enviar</button>
      </div>
    </div>

    <div id="spinner" class="spinner-overlay d-none">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    
    <script>

      function applyPrefill() {
        for (const key in prefill) {
          const input = document.getElementById(key);
          if (!input) continue;

          if (input.tagName === 'SELECT' && input.multiple) {
            const values = prefill[key].split(',');
            for (const option of input.options) {
              option.selected = values.includes(option.value);
            }
            continue;
          }

          if (input.tagName === 'SELECT') {
            input.value = prefill[key];
            continue;
          }

          switch (input.type) {
            case 'radio':
            case 'checkbox':
              input.checked = prefill[key] === 'true' || prefill[key] === '1';
              break;
            default:
              input.value = prefill[key];
          }
        }
      }


      const sections = document.querySelectorAll('.section');
      const nextButton = document.getElementById('nextSection');
      const taskRadios = document.querySelectorAll('input[name="task"]');

      // Enable next button when any radio is selected
      taskRadios.forEach(radio =>
        radio.addEventListener('change', () => {
          nextButton.disabled = !document.querySelector('input[name="task"]:checked');
        })
      );

      // Add these event listeners after populating the selects
      document.getElementById('d_sol_Torobajo_select').addEventListener('change', function() {
        displayDeviceInfo(this, 'd_devices_Torobajo');
      });

      document.getElementById('d_sol_Centro_select').addEventListener('change', function() {
        displayDeviceInfo(this, 'd_devices_Centro');
      });

      function displayDeviceInfo(select, containerId) {
        const container = document.getElementById(containerId);
        const selectedOption = select.options[select.selectedIndex];
        
        if (!selectedOption.value) {
          container.innerHTML = '';
          return;
        }
        
        const control = selectedOption.dataset.control;
        const portatil = selectedOption.dataset.portatil;
        const otro = selectedOption.dataset.otro;
        
        container.innerHTML = `
          <div class="alert alert-info">
            <p class="mb-1"><strong>Control:</strong> ${control || 'N/A'}</p>
            <p class="mb-1"><strong>Portátil:</strong> ${portatil || 'N/A'}</p>
            <p class="mb-0"><strong>Otro:</strong> ${otro || 'N/A'}</p>
          </div>
        `;
      }

      function goToSection(sectionSelected) {
        sections.forEach(sec =>
          sec.classList.toggle('active', sec.id === sectionSelected)
        );

        switch (sectionSelected) {
          case 'InventarioSection':
            google.script.run.withSuccessHandler(renderPlaceOptions).getPlaceOptions();
            break;

            case 'PréstamoSection':
              google.script.run.withSuccessHandler(renderDeviceOptions).getDeviceOptions();
              break;
              
            case 'DevoluciónSection':
              google.script.run.withSuccessHandler(renderNotReturnedDevicesBySolicitante).getNotReturnedDevicesBySolicitante();
              break;
                
            case 'SoporteSection':
              google.script.run.withSuccessHandler(renderAllDevicesByTypeOfPlate).getAllDevicesByTypeOfPlate();
              break;

          default:
            break;
        }
      }

      function returnToMenu() {
        sections.forEach(sec => sec.classList.remove('active'));

        const menu = document.getElementById('MenuSection');
        if (menu) menu.classList.add('active');
      }

      //--------------------------------------------------------------
      function initConditionalVisibility() {
        const inputs = document.querySelectorAll('[data-toggle-target]');
        const groups = {};
        inputs.forEach(input => {
          const targetSelector = input.dataset.toggleTarget;
          const expectedValue = input.dataset.toggleValue;
          const name = input.name;
          if (!groups[name]) {
            groups[name] = [];
          }
          groups[name].push({ input, targetSelector, expectedValue });
        });
        Object.entries(groups).forEach(([groupName, groupInputs]) => {
          const allInputs = document.querySelectorAll(`input[name="${groupName}"]`);
          const updateGroup = () => {
            groupInputs.forEach(({ targetSelector, expectedValue }) => {
              // Changed from querySelector to querySelectorAll
              const targets = document.querySelectorAll(targetSelector);
              const selected = Array.from(allInputs).find(i => i.checked);
              const currentValue = selected?.value;
              const isMatch = currentValue === expectedValue;
              
              // Loop through all matched targets
              targets.forEach(target => {
                if (isMatch) {
                  target?.classList.remove('d-none');
                  target?.querySelectorAll('input, select, textarea').forEach(el => {
                    el.required = true;
                    document.getElementById('p_chdmi_Torobajo').removeAttribute('required');
                    document.getElementById('p_cportatil_Torobajo').removeAttribute('required');
                    document.getElementById('p_cotro_Torobajo').removeAttribute('required');
                    document.getElementById('p_chdmi_Centro').removeAttribute('required');
                    document.getElementById('p_cportatil_Centro').removeAttribute('required');
                    document.getElementById('p_cotro_Centro').removeAttribute('required');
                    el.disabled = false;
                  });
                } else {
                  target?.classList.add('d-none');
                  target?.querySelectorAll('input, select, textarea').forEach(el => {
                    el.required = false;
                    el.disabled = true;
                    el.value = '';
                  });
                }
              });
            });
          };
          allInputs.forEach(input => input.addEventListener('change', updateGroup));
          updateGroup(); // Run once initially
        });
      }




      //--------------------------------------------------------------

      function handleSubmit(e) {
        e.preventDefault();

        const form = e.target;
        const multiSelects = form.querySelectorAll('select[multiple]');
        
        // Review disabling empty multi-selects, if not necessary then remove this block
        const disabledSelects = [];
        multiSelects.forEach(select => {
          if (select.options.length === 0 && !select.required) {
            select.disabled = true;
            disabledSelects.push(select);
          }
        });

        const spinner = document.getElementById('spinner');
        const submitBtn = document.getElementById('submit-button');

        // Show spinner and disable button
        spinner.classList.remove('d-none');
        submitBtn.disabled = true;

        const formData = new FormData(form);
        const data = {};

        formData.forEach((value, key) => {
          data[key] = value;
        });

        data.formId = form.id;

        if(form.id === 'Inventario') {
          data.URL = createURLParams(form);
          const selectedSede = data['Sede (I)'];

          // Get the value from the correct select based on the selected sede
          if (selectedSede === 'Torobajo') {
            data['Ubicación ( Oficina - Aula) (I)'] = document.getElementById('i_u_Torobajo').value;
          } else if (selectedSede === 'Centro') {
            data['Ubicación ( Oficina - Aula) (I)'] = document.getElementById('i_u_Centro').value;
          }
        }

        if(form.id === 'Soporte') {
          const selectedPlaca = data['Tipo de Placa (S)'];

          // Get the value from the correct select based on the selected sede
          if (selectedPlaca === 'FUCS') {
            data['Placa Inventario (S)'] = document.getElementById('s_pi_FUCS_select').value;
          } else if (selectedPlaca === 'TMS') {
            data['Placa Inventario (S)'] = document.getElementById('s_pi_TMS_select').value;
          }
        }

        if(form.id === 'Préstamo') {
          const selectedSede = data['Sede (P)'];

          // Get the value from the correct select based on the selected sede
          if (selectedSede === 'Torobajo') {
            data['Cuál control HDMI? (P)'] = document.getElementById('p_chdmi_Torobajo').value;
            data['Cuál portátil? (P)'] = document.getElementById('p_cportatil_Torobajo').value;
            data['Cuál otro? (P)'] = document.getElementById('p_cotro_Torobajo').value;
          } else if (selectedSede === 'Centro') {
            data['Cuál control HDMI? (P)'] = document.getElementById('p_chdmi_Centro').value;
            data['Cuál portátil? (P)'] = document.getElementById('p_cportatil_Centro').value;
            data['Cuál otro? (P)'] = document.getElementById('p_cotro_Centro').value;
          }
        }

        if(form.id === 'Devolución') {
          const selectedSede = data['Sede (D)'];

          // Get the value from the correct select based on the selected sede
          if (selectedSede === 'Torobajo') {
            data['Nombre del solicitante (D)'] = document.getElementById('d_sol_Torobajo_select').value;
          } else if (selectedSede === 'Centro') {
            data['Nombre del solicitante (D)'] = document.getElementById('d_sol_Centro_select').value;
          }

          const selectedEstado = data['Estado del equipo al momento de la devolución (D)'];

          if (selectedEstado === 'No Funciona') {
            data['Causa del problema o no funcionamiento? (D)'] = document.getElementById('d_causa_no_funciona').value;
          } else if (selectedEstado === 'Con problemas') {
            data['Causa del problema o no funcionamiento? (D)'] = document.getElementById('d_causa_problemas').value;
          }
        }

        // Process multi-select values (only for enabled selects with options)
        multiSelects.forEach(select => {
          if (!select.disabled) {
            const selectedOptions = Array.from(select.selectedOptions).map(option => option.value);
            if (selectedOptions.length > 0) {
              data[select.name] = selectedOptions.join(',');
            }
          }
        });

        google.script.run
          .withSuccessHandler(() => {
            // Re-enable temporarily disabled selects
            disabledSelects.forEach(select => select.disabled = false);
            
            alert('Formulario enviado correctamente.');
            spinner.classList.add('d-none');
            submitBtn.disabled = false;
            form.reset();
            returnToMenu();
          })
          .withFailureHandler(error => {
            // Re-enable temporarily disabled selects
            disabledSelects.forEach(select => select.disabled = false);
            
            alert('Error: ' + error.message);
            spinner.classList.add('d-none');
            submitBtn.disabled = false;
          })
          .submitForm(data);
      }


      function createURLParams(form) {
        const inputs = form.querySelectorAll('input');
        const selects = form.querySelectorAll('select');
        const params = new URLSearchParams();

        inputs.forEach(input => {
          if ((input.type === 'radio' || input.type === 'checkbox') && input.checked) {
            params.append(input.id, true);
          } else if (input.type !== 'radio' && input.type !== 'checkbox') {
            params.append(input.id, input.value);
          }

        });

        selects.forEach(select => {
          if (select.multiple) {
            Array.from(select.selectedOptions).forEach(option => {
              params.append(select.id, option.value);
            });
          } else {
            params.append(select.id, select.value);
          }
        });

        return params.toString();
      }

      let placeOptionsLoaded = false;
      let deviceOptionsLoaded = false;
      let allDevicesByTypeOfPlateLoaded = false;
      let notReturnedDevicesBySolicitanteLoaded = false;

      google.script.run.withSuccessHandler(renderDeviceOptions).getDeviceOptions();
      google.script.run.withSuccessHandler(renderPlaceOptions).getPlaceOptions();
      google.script.run.withSuccessHandler(renderAllDevicesByTypeOfPlate).getAllDevicesByTypeOfPlate();
      google.script.run.withSuccessHandler(renderNotReturnedDevicesBySolicitante).getNotReturnedDevicesBySolicitante();

      function renderNotReturnedDevicesBySolicitante(data) {
        populateNotReturnedDevicesBySolicitanteSelect("d_sol_Torobajo_select", data.Torobajo);
        populateNotReturnedDevicesBySolicitanteSelect("d_sol_Centro_select", data.Centro);
        notReturnedDevicesBySolicitanteLoaded = true;
        checkAllLoaded();
      }


      
      function renderAllDevicesByTypeOfPlate(data) {
        populateAllDevicesByTypeOfPlateSelect("s_pi_FUCS_select", data.FUCS);
        populateAllDevicesByTypeOfPlateSelect("s_pi_TMS_select", data.TMS);
        allDevicesByTypeOfPlateLoaded = true;
        checkAllLoaded();
      }
      
      function renderPlaceOptions(data) {
        populatePlaceSelect("i_u_Torobajo", data.Torobajo);
        populatePlaceSelect("i_u_Centro", data.Centro);
        placeOptionsLoaded = true;
        checkAllLoaded();
      }

      function renderDeviceOptions(data) {
        populateDeviceSelect("p_chdmi_Torobajo", data.hdmi, "Torobajo");
        populateDeviceSelect("p_cportatil_Torobajo", data.portatil, "Torobajo");
        populateDeviceSelect("p_cotro_Torobajo", data.otro, "Torobajo");
        populateDeviceSelect("p_chdmi_Centro", data.hdmi, "Centro");
        populateDeviceSelect("p_cportatil_Centro", data.portatil, "Centro");
        populateDeviceSelect("p_cotro_Centro", data.otro, "Centro");
        deviceOptionsLoaded = true;
        checkAllLoaded();
      }

      function checkAllLoaded() {
        if (placeOptionsLoaded && deviceOptionsLoaded && allDevicesByTypeOfPlateLoaded && notReturnedDevicesBySolicitanteLoaded) {
          applyPrefill();
          initConditionalVisibility();
        }
      }

      function populatePlaceSelect(selectId, options) {
        const select = document.getElementById(selectId);

        while (select.options.length > 1) {
          select.remove(1);
        }

        options.forEach(opt => {
          const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.value;
            select.appendChild(option);
          });
      }

      function populateNotReturnedDevicesBySolicitanteSelect(selectId, options) {
        const select = document.getElementById(selectId);

        while (select.options.length > 1) {
          select.remove(1);
        }

        options.forEach(opt => {
          const option = document.createElement("option");
            option.value = opt.solicitante;
            option.textContent = `${opt.solicitante} - ${opt.tipoSolicitante}`;
            option.dataset.solicitante = opt.solicitante || '';
            option.dataset.control = opt.control || '';
            option.dataset.portatil = opt.portatil || '';
            option.dataset.otro = opt.otro || '';

            select.appendChild(option);
          });
      }
      
      // MAYBE DELETE IT AND USE populatePlaceSelect INSTEAD
      function populateAllDevicesByTypeOfPlateSelect(selectId, options) {
        const select = document.getElementById(selectId);

        while (select.options.length > 1) {
          select.remove(1);
        }
        
        options.forEach(opt => {
          const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.value;
            select.appendChild(option);
          });
      }
      
      function populateDeviceSelect(selectId, options, sede) {
        const select = document.getElementById(selectId);

        while (select.options.length > 0) {
          select.remove(0);
        }

        options.forEach(opt => {
          const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.value;
          if (opt.sede === sede && !opt.disabled) {
            select.appendChild(option);
          }
        });
      }

    </script>



  </body>
</html>
